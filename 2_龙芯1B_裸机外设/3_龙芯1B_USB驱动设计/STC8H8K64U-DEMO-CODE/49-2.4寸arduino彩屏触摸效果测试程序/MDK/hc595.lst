C51 COMPILER V9.59.0.0   HC595                                                             02/08/2021 11:44:59 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE HC595
OBJECT MODULE PLACED IN .\Out_File\hc595.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ..\Device\hc595.c LARGE OPTIMIZE(8,SPEED) BROWSE INCDIR(..\Device;..\Lib
                    -raries) DEBUG OBJECTEXTEND PRINT(.\hc595.lst) TABS(2) OBJECT(.\Out_File\hc595.obj)

line level    source

   1          
   2          
   3          /*************  技术支持与购买说明    **************
   4          产品主页：http://tw51.haohaodada.com
   5          淘宝搜索：天问51，可购买。目前基础版99元，带彩屏标准备版149元
   6          技术支持QQ群一：1138055784
   7          ******************************************/
   8          #include "hc595.h"
   9          #include "delay.h"
  10          
  11          //位码
  12          code uint8 _595_bdata[8]={0x01,0x02,0x04,0x08,0x10,0x20,0x40,0x80};
  13          
  14          //========================================================================
  15          // 描述: 595初始化引脚.
  16          // 参数: none.
  17          // 返回: none.
  18          //========================================================================
  19          void hc595_init()
  20          { 
  21   1          HC595_DS_MODE;        //引脚初始化
  22   1          HC595_STCP_MODE;
  23   1          HC595_SHCP_MODE;
  24   1      
  25   1          HC595_DS = 0;
  26   1          HC595_STCP = 0;
  27   1          HC595_SHCP = 0;
  28   1      }
  29          
  30          //========================================================================
  31          // 描述: 595使能输出.
  32          // 参数: none.
  33          // 返回: none.
  34          //========================================================================
  35          void hc595_out_enable()
  36          {
  37   1          HC595_STCP = 0;
  38   1          delay10us();
  39   1          HC595_STCP = 1;
  40   1          delay10us();
  41   1          HC595_STCP = 0;
  42   1      }
  43          
  44          //========================================================================
  45          // 描述: 595发送8位数据.
  46          // 参数: 8位数据.
  47          // 返回: none.
  48          //========================================================================
  49          void hc595_send_byte(uint8 outdata)
  50          {
  51   1          uint8 i;
  52   1          for(i=0;i<8;i++)  //将8位数据按位发送，先发高字节再发低字节
  53   1        {      
  54   2              if((outdata&0x80)==0x80)
C51 COMPILER V9.59.0.0   HC595                                                             02/08/2021 11:44:59 PAGE 2   

  55   2            {
  56   3                  HC595_DS = 1;
  57   3              }
  58   2            else
  59   2            {
  60   3                  HC595_DS = 0;
  61   3              }
  62   2              delay10us();
  63   2              HC595_SHCP = 0; //时钟线低电平
  64   2              delay10us();
  65   2              HC595_SHCP = 1; //时钟线高电平
  66   2              delay10us();
  67   2              outdata = outdata<<1;
  68   2          }
  69   1      }
  70          
  71          //========================================================================
  72          // 描述: 595发送数组.
  73          // 参数: 数组地址，数据长度.
  74          // 返回: none.
  75          //========================================================================
  76          void hc595_send_multi_byte(uint8 *ddata,uint16 len)
  77          {
  78   1          uint16 i;
  79   1          for(i=0;i<len;i++)
  80   1        {
  81   2              hc595_send_byte(ddata[i]);
  82   2          }
  83   1          hc595_out_enable();
  84   1      }
  85          
  86          //========================================================================
  87          // 描述: 595输出禁止.
  88          // 参数: 数组地址，数据长度.
  89          // 返回: none.
  90          //========================================================================
  91          void hc595_disable()
  92          {
  93   1          uint8 buf[2]={0,0};
  94   1          hc595_send_multi_byte(buf,2);
  95   1      }
  96          
  97          //========================================================================
  98          // 描述: 595使能数码管.
  99          // 参数: 数组地址，数据长度.
 100          // 返回: none.
 101          //========================================================================
 102          void hc595_enable_nix()
 103          {
 104   1          uint8 buf[2]={0,0xff};
 105   1          hc595_send_multi_byte(buf,2);
 106   1      }
 107          
 108          //========================================================================
 109          // 描述: 595使能点阵.
 110          // 参数: 数组地址，数据长度.
 111          // 返回: none.
 112          //========================================================================
 113          void hc595_enable_matrix()
 114          {
 115   1          uint8 buf[2]={0xff,0};
 116   1          hc595_send_multi_byte(buf,2);
C51 COMPILER V9.59.0.0   HC595                                                             02/08/2021 11:44:59 PAGE 3   

 117   1      }
 118          
 119          //========================================================================
 120          // 描述: 595发送位选
 121          // 参数: (0~15)位.
 122          // 返回: none.
 123          //========================================================================
 124          void hc595_bit_select(uint8 index)
 125          {
 126   1          //位选
 127   1          uint8 buf[2]={0,0};
 128   1          if(index>7)
 129   1          {
 130   2              buf[0]=_595_bdata[index-8];//COM8~COM15 点阵
 131   2          }
 132   1          else
 133   1          {
 134   2              buf[1]=_595_bdata[index];//COM0~COM7  数码管
 135   2          }
 136   1          
 137   1          hc595_send_multi_byte(buf,2);
 138   1      }
 139          
 140          //========================================================================
 141          // 描述: 595消影
 142          // 参数: none.
 143          // 返回: none.
 144          //========================================================================
 145          void hc595_bit_disable()
 146          {
 147   1          //位选
 148   1          uint8 buf[2]={0,0};
 149   1          hc595_send_multi_byte(buf,2);
 150   1      }
 151          
 152          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    387    ----
   CONSTANT SIZE    =     18    ----
   XDATA SIZE       =   ----      20
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
